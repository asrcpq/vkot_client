pty compatibility mode

todo:
split server msg
